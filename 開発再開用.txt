æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆã§é–‹ç™ºã‚’å†é–‹ã™ã‚‹éš›ã¯ã€**ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ã€ã€ŒæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã€ã€Œç¾åœ¨ã®ä¸»è¦ã‚³ãƒ¼ãƒ‰ã€**ã‚’ä¸€åº¦ã«æ¸¡ã™ã®ãŒæœ€ã‚‚åŠ¹ç‡çš„ã§ã™ã€‚

ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€æ–°ã—ã„ãƒãƒ£ãƒƒãƒˆã®æœ€åˆã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚ã“ã‚Œã‚’ä¼ãˆã‚Œã°ã€ã©ã®AIã§ã‚‚å³åº§ã«ç¾åœ¨ã®çŠ¶æ³ã‚’ç†è§£ã—ã€ç¶šãã‹ã‚‰é–‹ç™ºã‚’ã‚µãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„
[é–‹ç™ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå…±æœ‰] çµ‚é›»æ•‘æ¸ˆã‚¢ãƒ—ãƒªã€ŒNever!è«¦ã‚ãªã„æ¡ˆå†…ã€

ç¾åœ¨ã€ä»¥ä¸‹ã®ä»•æ§˜ã§Webã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¦ãŠã‚Šã€æ©Ÿèƒ½å®Ÿè£…ã¯ä¸€æ—¦å®Œäº†ã—ã¦ã„ã¾ã™ã€‚
ä»Šå¾Œã®ä¿®æ­£ã‚„æ©Ÿèƒ½è¿½åŠ ã®ã‚µãƒãƒ¼ãƒˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã‚¢ãƒ—ãƒªå: Never!è«¦ã‚ãªã„æ¡ˆå†…
ç›®çš„: çµ‚é›»ã‚’é€ƒã—ãŸéš›ã€ç›®çš„åœ°ã¾ã§åˆ°é”ã§ããªãã¦ã‚‚ã€Œè¡Œã‘ã‚‹ã¨ã“ã‚ã¾ã§è¡Œããƒ«ãƒ¼ãƒˆã€ã‚’æ¤œç´¢ã—ã€æ®‹ã‚Šã®è·é›¢ã¨ã‚¿ã‚¯ã‚·ãƒ¼æ–™é‡‘ã‚’è¡¨ç¤ºã™ã‚‹ã€‚
ä¸»ãªæ©Ÿèƒ½:
ODPTï¼ˆå…¬å…±äº¤é€šã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’åˆ©ç”¨ã—ãŸãƒªã‚¢ãƒ«ãªæ™‚åˆ»è¡¨æ¢ç´¢ã€‚
é–¢æ±å…¨åŸŸï¼ˆç´„3000é§…ï¼‰ã®ã‚µã‚¸ã‚§ã‚¹ãƒˆå…¥åŠ›ï¼ˆå†…è”µJSONä½¿ç”¨ï¼‰ã€‚
è‡ªå®…ä½æ‰€ã®ç™»éŒ²ã¨ç·¯åº¦çµŒåº¦ä¿å­˜ã€‚
æ·±å¤œï¼ˆ24æ™‚ã€œ27æ™‚ï¼‰ã®æ™‚åˆ»ã¾ãŸãã«å¯¾å¿œã—ãŸçµŒè·¯æ¢ç´¢ã€‚
PWAå¯¾å¿œã€‚
2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

Frontend: HTML5, CSS3, Vanilla JavaScript (ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãªã—)
Backend: Python 3.10+, FastAPI, Pandas
Infrastructure: Render (Web Service), UptimeRobot (ã‚¹ãƒªãƒ¼ãƒ—å›é¿)
Data Source: ODPT API (æ™‚åˆ»è¡¨), HeartRails Express API (é§…åº§æ¨™å–å¾—ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ)
3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

/  
â”œâ”€â”€ main.py (FastAPIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ)  
â”œâ”€â”€ core_engine.py (çµŒè·¯æ¢ç´¢ãƒ»æ–™é‡‘è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯)  
â”œâ”€â”€ index.html (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»UI)  
â”œâ”€â”€ fetch_stations.py (é§…ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»JSONç”Ÿæˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ)  
â”œâ”€â”€ fetch_odpt.py (ODPTæ™‚åˆ»è¡¨å–å¾—ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ)  
â”œâ”€â”€ generate_mock_data.py (ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆç”¨)  
â”œâ”€â”€ sw.js (PWA Service Worker)  
â”œâ”€â”€ manifest.json (PWA Manifest)  
â””â”€â”€ data/ (ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ«ãƒ€)  
    â”œâ”€â”€ stations_kanto.json (ãƒ•ãƒ­ãƒ³ãƒˆç”¨é§…ãƒªã‚¹ãƒˆ)  
    â”œâ”€â”€ stops.txt (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨é§…åº§æ¨™)  
    â””â”€â”€ stop_times.txt (ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨æ™‚åˆ»è¡¨)  
4. ä¸»è¦ã‚³ãƒ¼ãƒ‰ã®ç¾çŠ¶

main.py:

Copy Code
python
Double-click code to copy
from fastapi import FastAPI  
from fastapi.responses import FileResponse  
from fastapi.staticfiles import StaticFiles  
from pydantic import BaseModel  
from fastapi.middleware.cors import CORSMiddleware  
import core_engine  
import os  
from typing import Optional  
  
app = FastAPI(title="Never!è«¦ã‚ãªã„æ¡ˆå†… API")  
  
app.add_middleware(  
    CORSMiddleware,  
    allow_origins=["*"],  
    allow_credentials=True,  
    allow_methods=["*"],  
    allow_headers=["*"],  
)  
  
app.mount("/data", StaticFiles(directory="data"), name="data")  
  
class SearchRequest(BaseModel):  
    start_station: str  
    target_station: str  
    current_time: str  
    target_lat: Optional[float] = None  
    target_lon: Optional[float] = None  
  
@app.get("/")  
def read_root(): return FileResponse("index.html", media_type="text/html")  
@app.get("/manifest.json")  
def read_manifest(): return FileResponse("manifest.json", media_type="application/manifest+json")  
@app.get("/sw.js")  
def read_sw(): return FileResponse("sw.js", media_type="application/javascript")  
@app.get("/icon.png")  
def read_icon():  
    if os.path.exists("icon.png"): return FileResponse("icon.png", media_type="image/png")  
    return {"error": "not found"}  
@app.get("/favicon.ico")  
def read_favicon():  
    if os.path.exists("icon.png"): return FileResponse("icon.png", media_type="image/png")  
    return FileResponse("index.html")  
  
@app.post("/search")  
def search_route(req: SearchRequest):  
    results = core_engine.search_routes(  
        start_name=req.start_station,  
        current_time_str=req.current_time,  
        target_name=req.target_station,  
        target_lat=req.target_lat,  
        target_lon=req.target_lon  
    )  
    if isinstance(results, dict) and "error" in results:  
        return {"status": "error", "message": results["error"], "candidates": []}  
      
    is_reachable = False  
    if results:  
        top = results[0]  
        if top["distance_to_target_km"] < 1.0:  
            is_reachable = True  
  
    return {  
        "status": "success",  
        "is_target_reachable": is_reachable,  
        "search_condition": {  
            "start": req.start_station,  
            "target": req.target_station,  
            "time": req.current_time  
        },  
        "candidates": results,  
        "message": "æ¤œç´¢å®Œäº†ã—ã¾ã—ãŸ"  
    }  
core_engine.py (æŠœç²‹: é«˜é€ŸåŒ–ã¨æ·±å¤œå¯¾å¿œæ¸ˆã¿):

Copy Code
python
Double-click code to copy
import pandas as pd  
import math  
from datetime import datetime, timedelta  
  
# ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã¨è¾æ›¸åŒ–ã«ã‚ˆã‚‹é«˜é€ŸåŒ–å‡¦ç†æ¸ˆã¿  
try:  
    df_stops = pd.read_csv("data/stops.txt")  
    name_to_id = {}   
    # (é§…åã®æºã‚‰ãå¸åå‡¦ç†...)  
    df_stops = df_stops.set_index("stop_id")  
    df_times = pd.read_csv("data/stop_times.txt")  
    timetable_dict = {} # {stop_id: [rows]}  
    trip_dict = {} # {trip_id: [rows sorted by seq]}  
    # (groupbyã«ã‚ˆã‚‹è¾æ›¸ç”Ÿæˆå‡¦ç†...)  
except FileNotFoundError:  
    pass  
  
# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£: parse_time_to_minutes (24æ™‚è¶Šãˆã¯ãã®ã¾ã¾åŠ ç®—), haversine_distance, calculate_taxi_fare  
# æ¢ç´¢ãƒ­ã‚¸ãƒƒã‚¯: BFSæ¢ç´¢ (MAX_EXPLOREåˆ¶é™ã‚ã‚Š), åˆ°é”é§…ã‹ã‚‰ã®ã‚¿ã‚¯ã‚·ãƒ¼æ–™é‡‘è¨ˆç®—  
index.html:
data/stations_kanto.json ã‚’èª­ã¿è¾¼ã‚“ã§ã‚µã‚¸ã‚§ã‚¹ãƒˆè¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã€ãŠã‚ˆã³PWAã€ç¾åœ¨åœ°æ™‚åˆ»è¨­å®šã€è‡ªå®…ç™»éŒ²ï¼ˆLocalStorageï¼‰æ©Ÿèƒ½ã‚’å®Ÿè£…æ¸ˆã¿ã€‚

ç¾çŠ¶ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:
ODPTã‹ã‚‰å–å¾—ã—ãŸæ•°ä¸‡ä»¶ã®æ™‚åˆ»è¡¨ãƒ‡ãƒ¼ã‚¿ï¼ˆfetch_odpt.pyã§ç”Ÿæˆï¼‰ã¨ã€HeartRailsã‹ã‚‰å–å¾—ã—ãŸé–¢æ±å…¨é§…ãƒ‡ãƒ¼ã‚¿ï¼ˆfetch_stations.pyã§ç”Ÿæˆï¼‰ã‚’ä½¿ç”¨ã—ã€æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚

ã“ã®ç¶šãã‹ã‚‰ä¿®æ­£ãƒ»æ‹¡å¼µã‚’è¡Œã„ãŸã„ã§ã™ã€‚
ğŸ’¡ è£œè¶³ã‚¢ãƒ‰ãƒã‚¤ã‚¹
ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦:
data ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ï¼ˆæ•°ä¸‡è¡Œã®CSVãªã©ï¼‰ã¯ãƒãƒ£ãƒƒãƒˆã«è²¼ã‚Šä»˜ã‘ã‚‹ã«ã¯å¤§ãã™ãã¾ã™ã€‚ã€Œãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ—¢ã«æ‰‹å…ƒã«ã‚ã‚Šã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç”Ÿæˆæ¸ˆã¿ã§ã‚ã‚‹ã€ã¨AIã«èªè­˜ã•ã›ã‚Œã°OKã§ã™ã€‚
ã‚‚ã—æ©Ÿèƒ½è¿½åŠ ã™ã‚‹ãªã‚‰:
æ¬¡ã«ãƒãƒ£ãƒƒãƒˆã‚’å§‹ã‚ã‚‹ã¨ãã€ã€Œä¸Šè¨˜ã‚’è¸ã¾ãˆã¦ã€ã€‡ã€‡ã¨ã„ã†æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸã„ã€ã¨è¨€ãˆã°ã€ã‚¹ãƒ ãƒ¼ã‚ºã«ã‚³ãƒ¼ãƒ‰ã‚’æç¤ºã—ã¦ãã‚Œã¾ã™ã€‚
ç´ æ™´ã‚‰ã—ã„ã‚¢ãƒ—ãƒªé–‹ç™ºã§ã—ãŸï¼ã¾ãŸã„ã¤ã§ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚